<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Emoji Horse Arcade</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: radial-gradient(circle at 20% 20%, #111827, #020617);
      color: #fff;
      height: 100vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
    }
    .hud {
      width: 100%;
      padding: 12px 18px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 21px; /* + ~30% */
    }
    .hud span { margin-right: 8px; }

    #game {
      position: relative;
      width: 100%;
      max-width: 480px;
      height: calc(100vh - 130px);
      background: linear-gradient(#0b1120, #020617);
      border-top: 1px solid #374151;
      border-bottom: 1px solid #374151;
      overflow: hidden;
    }

    /* —Å–Ω–µ–≥ */
    .snowflake {
      position: absolute;
      top: -10px;
      color: #e5e7eb;
      opacity: 0.6;
      font-size: 10px;
      pointer-events: none;
      animation-name: fall;
      animation-timing-function: linear;
      animation-iteration-count: infinite;
    }
    @keyframes fall {
      to {
        transform: translateY(110vh);
      }
    }

    .player, .item {
      position: absolute;
      font-size: 42px; /* –±—ã–ª–æ 32px, +~30% */
      pointer-events: none;
      transform: translate(-50%, -50%);
    }
    .player {
      bottom: 12%;
      left: 50%;
    }

    .controls {
      width: 100%;
      max-width: 480px;
      display: flex;
      justify-content: space-between;
      padding: 8px 16px 12px;
      gap: 8px;
    }
    .btn {
      flex: 1;
      padding: 10px 0;
      font-size: 22px;
      border-radius: 999px;
      border: none;
      background: #111827;
      color: #fff;
      box-shadow: 0 0 12px rgba(255,255,255,0.08);
      touch-action: manipulation;
    }
    .btn:active { background: #1f2937; }

    #message {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      gap: 10px;
      background: rgba(0,0,0,0.65);
      font-size: 19px;
      text-align: center;
      padding: 16px;
    }
    #message button {
      padding: 8px 20px;
      border-radius: 20px;
      border: none;
      background: #22c55e;
      color: #fff;
      font-size: 17px;
    }

    @media (orientation: landscape) {
      #game { height: calc(100vh - 90px); }
      .player, .item { font-size: 36px; }
    }
  </style>
</head>
<body>
  <div class="hud">
    <div><span>‚≠ê –°—á—ë—Ç:</span><span id="score">0</span></div>
    <div><span>‚ù§Ô∏è –ñ–∏–∑–Ω–∏:</span><span id="lives">3</span></div>
  </div>

  <div id="game">
    <!-- –ª–æ—à–∞–¥–∫–∞-–≥–µ—Ä–æ–π -->
    <div id="player" class="player">üê¥</div>

    <!-- —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–≤–µ—Ä—Ö -->
    <div id="message">
      <div style="font-size:24px;">–ù–æ–≤–æ–≥–æ–¥–Ω—è—è –ª–æ—à–∞–¥–∫–∞ üéÑ</div>
      <div>–õ–æ–≤–∏ —Ö–æ—Ä–æ—à–∏–µ —ç–º–æ–¥–∑–∏ (üçé‚ú®üíéüéÅüéÑ), –∏–∑–±–µ–≥–∞–π –æ–ø–∞—Å–Ω—ã—Ö (üí£üî•).</div>
      <div>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: ‚óÄ ‚ñ∂ –∏–ª–∏ —Å–≤–∞–π–ø—ã –ø–æ —ç–∫—Ä–∞–Ω—É.</div>
      <button id="startBtn">–ò–≥—Ä–∞—Ç—å</button>
    </div>
  </div>

  <div class="controls">
    <button class="btn" id="leftBtn">‚óÄ</button>
    <button class="btn" id="rightBtn">‚ñ∂</button>
  </div>

  <!-- –∑–≤—É–∫–∏ -->
  <audio id="sound-good" preload="auto">
    <source src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg" type="audio/ogg">
  </audio>
  <audio id="sound-bad" preload="auto">
    <source src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" type="audio/ogg">
  </audio>

  <script>
    const game = document.getElementById('game');
    const player = document.getElementById('player');
    const scoreEl = document.getElementById('score');
    const livesEl = document.getElementById('lives');
    const message = document.getElementById('message');
    const startBtn = document.getElementById('startBtn');
    const leftBtn = document.getElementById('leftBtn');
    const rightBtn = document.getElementById('rightBtn');

    const soundGood = document.getElementById('sound-good');
    const soundBad  = document.getElementById('sound-bad');

    // –Ω–æ–≤–æ–≥–æ–¥–Ω–∏–µ —ç–º–æ–¥–∑–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã
    const goodEmojis = ['üçé','üçí','‚ú®','üíé','üçÄ','‚≠ê','üç≠','üéÅ','üéÑ','‚òÉÔ∏è','üßÅ'];
    const badEmojis  = ['üí£','üî•','‚ö°','‚ò†Ô∏è','üå©Ô∏è'];

    let score = 0;
    let lives = 3;
    let playerX = 50; // –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö
    let running = false;
    let spawnTimer = 0;
    let items = [];
    let lastTime = 0;

    function setPlayerPos() {
      if (playerX < 5) playerX = 5;
      if (playerX > 95) playerX = 95;
      player.style.left = playerX + '%';
    }

    function resetGame() {
      score = 0;
      lives = 3;
      scoreEl.textContent = score;
      livesEl.textContent = lives;
      items.forEach(i => i.el.remove());
      items = [];
      spawnTimer = 0;
      lastTime = performance.now();
    }

    function spawnItem() {
      const isBad = Math.random() < 0.25;
      const emoji = isBad
        ? badEmojis[Math.floor(Math.random()*badEmojis.length)]
        : goodEmojis[Math.floor(Math.random()*goodEmojis.length)];
      const el = document.createElement('div');
      el.className = 'item';
      el.textContent = emoji;
      const x = 10 + Math.random() * 80;
      const y = -5;
      el.style.left = x + '%';
      el.style.top  = y + '%';
      game.appendChild(el);
      items.push({
        el,
        x,
        y,
        vy: 11 + Math.random()*9,
        bad: isBad
      });
    }

    function rectsOverlap(ax, ay, aw, ah, bx, by, bw, bh) {
      return ax < bx + bw && ax + aw > bx && ay < by + bh && ay + ah > by;
    }

    function update(t) {
      if (!running) return;
      const dt = (t - lastTime) / 1000;
      lastTime = t;

      // —Å–ø–∞–≤–Ω
      spawnTimer += dt;
      const interval = 0.8;
      if (spawnTimer >= interval) {
        spawnTimer = 0;
        spawnItem();
      }

      const gameRect = game.getBoundingClientRect();
      const playerRect = player.getBoundingClientRect();

      // –¥–≤–∏–∂–µ–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–æ–≤
      items.forEach(obj => {
        obj.y += obj.vy * dt * 4;
        obj.el.style.top = obj.y + '%';
      });

      // —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è –∏ —É–¥–∞–ª–µ–Ω–∏–µ
      items = items.filter(obj => {
        const r = obj.el.getBoundingClientRect();
        const offBottom = r.top > gameRect.bottom;

        if (!offBottom && rectsOverlap(
          r.left, r.top, r.width, r.height,
          playerRect.left, playerRect.top, playerRect.width, playerRect.height
        )) {
          if (obj.bad) {
            lives--;
            livesEl.textContent = lives;
            obj.el.textContent = 'üí•';
            try { soundBad.currentTime = 0; soundBad.play(); } catch(e){}
          } else {
            score += 10;
            scoreEl.textContent = score;
            obj.el.textContent = 'üîî';
            try { soundGood.currentTime = 0; soundGood.play(); } catch(e){}
          }
          obj.el.style.transition = 'opacity 0.2s';
          obj.el.style.opacity = '0';
          setTimeout(() => obj.el.remove(), 200);
          return false;
        }

        if (offBottom) {
          obj.el.remove();
          return false;
        }

        return true;
      });

      if (lives <= 0) {
        running = false;
        showMessage(`–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!<br>–°—á—ë—Ç: ${score}`);
        return;
      }

      requestAnimationFrame(update);
    }

    function showMessage(text) {
      message.style.display = 'flex';
      message.querySelector('div:nth-child(2)').innerHTML = text;
      startBtn.textContent = '–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞';
    }

    startBtn.addEventListener('click', () => {
      message.style.display = 'none';
      resetGame();
      running = true;
      requestAnimationFrame(update);
    });

    // –±–æ–ª–µ–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: —à–∞–≥ –¥–≤–∏–∂–µ–Ω–∏—è —É–≤–µ–ª–∏—á–µ–Ω
    const BUTTON_STEP = 12; // –±—ã–ª–æ 8
    const SWIPE_STEP  = 6;  // –±—ã–ª–æ 4

    leftBtn.addEventListener('touchstart', e => {
      e.preventDefault();
      playerX -= BUTTON_STEP;
      setPlayerPos();
    });
    rightBtn.addEventListener('touchstart', e => {
      e.preventDefault();
      playerX += BUTTON_STEP;
      setPlayerPos();
    });
    leftBtn.addEventListener('click', () => { playerX -= BUTTON_STEP; setPlayerPos(); });
    rightBtn.addEventListener('click', () => { playerX += BUTTON_STEP; setPlayerPos(); });

    // —Å–≤–∞–π–ø—ã ‚Äî —Ç–æ–∂–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–µ–µ
    let touchStartX = null;
    game.addEventListener('touchstart', e => {
      if (e.touches.length === 1) {
        touchStartX = e.touches[0].clientX;
      }
    });
    game.addEventListener('touchmove', e => {
      if (touchStartX === null) return;
      const dx = e.touches[0].clientX - touchStartX;
      if (Math.abs(dx) > 10) { // –±—ã–ª–æ 25
        playerX += dx > 0 ? SWIPE_STEP : -SWIPE_STEP;
        setPlayerPos();
        touchStartX = e.touches[0].clientX;
      }
    });
    game.addEventListener('touchend', () => {
      touchStartX = null;
    });

    // —Å—Ç—Ä–µ–ª–∫–∏ –Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ
    window.addEventListener('keydown', e => {
      if (e.key === 'ArrowLeft')  { playerX -= BUTTON_STEP; setPlayerPos(); }
      if (e.key === 'ArrowRight') { playerX += BUTTON_STEP; setPlayerPos(); }
    });

    setPlayerPos();

    // –ª—ë–≥–∫–∏–π —Å–Ω–µ–≥
    function createSnowflake() {
      const flake = document.createElement('div');
      flake.className = 'snowflake';
      flake.textContent = '‚ùÑ';
      flake.style.left = Math.random() * 100 + '%';
      flake.style.fontSize = (8 + Math.random()*6) + 'px';
      flake.style.opacity = (0.3 + Math.random()*0.4).toString();
      const duration = 8 + Math.random()*6;
      flake.style.animationDuration = duration + 's';
      game.appendChild(flake);
      setTimeout(() => flake.remove(), duration * 1000);
    }
    setInterval(createSnowflake, 450);
  </script>
</body>
</html>
