<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Emoji Arcade</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: radial-gradient(circle at 20% 20%, #222, #000);
      color: #fff;
      height: 100vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
    }
    .hud {
      width: 100%;
      padding: 10px 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 16px;
    }
    .hud span { margin-right: 8px; }

    #game {
      position: relative;
      width: 100%;
      max-width: 480px;
      height: calc(100vh - 110px);
      background: linear-gradient(#111, #050505);
      border-top: 1px solid #333;
      border-bottom: 1px solid #333;
      overflow: hidden;
    }

    .player, .item {
      position: absolute;
      font-size: 32px;
      pointer-events: none;
      transform: translate(-50%, -50%);
    }
    .player {
      bottom: 12%;
      left: 50%;
    }

    .controls {
      width: 100%;
      max-width: 480px;
      display: flex;
      justify-content: space-between;
      padding: 8px 16px 12px;
      gap: 8px;
    }
    .btn {
      flex: 1;
      padding: 10px 0;
      font-size: 20px;
      border-radius: 999px;
      border: none;
      background: #222;
      color: #fff;
      box-shadow: 0 0 12px rgba(255,255,255,0.08);
      touch-action: manipulation;
    }
    .btn:active { background: #333; }

    #message {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      gap: 10px;
      background: rgba(0,0,0,0.65);
      font-size: 18px;
      text-align: center;
      padding: 16px;
    }
    #message button {
      padding: 8px 20px;
      border-radius: 20px;
      border: none;
      background: #3b82f6;
      color: #fff;
      font-size: 16px;
    }

    @media (orientation: landscape) {
      #game { height: calc(100vh - 80px); }
      .player, .item { font-size: 28px; }
    }
  </style>
</head>
<body>
  <div class="hud">
    <div><span>‚≠ê –°—á—ë—Ç:</span><span id="score">0</span></div>
    <div><span>‚ù§Ô∏è –ñ–∏–∑–Ω–∏:</span><span id="lives">3</span></div>
  </div>

  <div id="game">
    <div id="player" class="player">üò∫</div>
    <div id="message">
      <div style="font-size:22px;">Emoji Arcade</div>
      <div>–õ–æ–≤–∏ —Ö–æ—Ä–æ—à–∏–µ —ç–º–æ–¥–∑–∏ (üçé‚ú®üíé), –∏–∑–±–µ–≥–∞–π –ø–ª–æ—Ö–∏—Ö (üí£üî•).</div>
      <div>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –∫–Ω–æ–ø–∫–∏ ‚óÄ ‚ñ∂ –∏–ª–∏ —Å–≤–∞–π–ø—ã.</div>
      <button id="startBtn">–ò–≥—Ä–∞—Ç—å</button>
    </div>
  </div>

  <div class="controls">
    <button class="btn" id="leftBtn">‚óÄ</button>
    <button class="btn" id="rightBtn">‚ñ∂</button>
  </div>

  <script>
    const game = document.getElementById('game');
    const player = document.getElementById('player');
    const scoreEl = document.getElementById('score');
    const livesEl = document.getElementById('lives');
    const message = document.getElementById('message');
    const startBtn = document.getElementById('startBtn');
    const leftBtn = document.getElementById('leftBtn');
    const rightBtn = document.getElementById('rightBtn');

    const goodEmojis = ['üçé','üçí','‚ú®','üíé','üçÄ','‚≠ê','üç≠'];
    const badEmojis  = ['üí£','üî•','‚ö°','‚ò†Ô∏è'];
    let score = 0;
    let lives = 3;
    let playerX = 50; // –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö
    let running = false;
    let spawnTimer = 0;
    let items = [];
    let lastTime = 0;

    function setPlayerPos() {
      if (playerX < 5) playerX = 5;
      if (playerX > 95) playerX = 95;
      player.style.left = playerX + '%';
    }

    function resetGame() {
      score = 0;
      lives = 3;
      scoreEl.textContent = score;
      livesEl.textContent = lives;
      items.forEach(i => i.el.remove());
      items = [];
      spawnTimer = 0;
      lastTime = performance.now();
    }

    function spawnItem() {
      const isBad = Math.random() < 0.25;
      const emoji = isBad
        ? badEmojis[Math.floor(Math.random()*badEmojis.length)]
        : goodEmojis[Math.floor(Math.random()*goodEmojis.length)];
      const el = document.createElement('div');
      el.className = 'item';
      el.textContent = emoji;
      const x = 10 + Math.random() * 80;
      const y = -5;
      el.style.left = x + '%';
      el.style.top  = y + '%';
      game.appendChild(el);
      items.push({
        el,
        x,
        y,
        vy: 12 + Math.random()*10,
        bad: isBad
      });
    }

    function rectsOverlap(ax, ay, aw, ah, bx, by, bw, bh) {
      return ax < bx + bw && ax + aw > bx && ay < by + bh && ay + ah > by;
    }

    function update(t) {
      if (!running) return;
      const dt = (t - lastTime) / 1000;
      lastTime = t;

      // —Å–ø–∞–≤–Ω
      spawnTimer += dt;
      const interval = 0.8; // —Å–µ–∫—É–Ω–¥—ã
      if (spawnTimer >= interval) {
        spawnTimer = 0;
        spawnItem();
      }

      const gameRect = game.getBoundingClientRect();
      const playerRect = player.getBoundingClientRect();

      // –¥–≤–∏–∂–µ–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–æ–≤
      items.forEach(obj => {
        obj.y += obj.vy * dt * 4; // —É—Å–∫–æ—Ä–∏–º –ø–∞–¥–µ–Ω–∏–µ
        obj.el.style.top = obj.y + '%';
      });

      // —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è –∏ —É–¥–∞–ª–µ–Ω–∏–µ
      items = items.filter(obj => {
        const r = obj.el.getBoundingClientRect();
        const offBottom = r.top > gameRect.bottom;

        if (!offBottom && rectsOverlap(
          r.left, r.top, r.width, r.height,
          playerRect.left, playerRect.top, playerRect.width, playerRect.height
        )) {
          // –ø–æ–π–º–∞–ª–∏
          if (obj.bad) {
            lives--;
            livesEl.textContent = lives;
            obj.el.textContent = 'üí•';
          } else {
            score += 10;
            scoreEl.textContent = score;
            obj.el.textContent = 'üéâ';
          }
          obj.el.style.transition = 'opacity 0.2s';
          obj.el.style.opacity = '0';
          setTimeout(() => obj.el.remove(), 200);
          return false;
        }

        if (offBottom) {
          obj.el.remove();
          return false;
        }

        return true;
      });

      if (lives <= 0) {
        running = false;
        showMessage(`–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!<br>–°—á—ë—Ç: ${score}`);
        return;
      }

      requestAnimationFrame(update);
    }

    function showMessage(text) {
      message.style.display = 'flex';
      message.querySelector('div:nth-child(2)').innerHTML = text;
      startBtn.textContent = '–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞';
    }

    startBtn.addEventListener('click', () => {
      message.style.display = 'none';
      resetGame();
      running = true;
      requestAnimationFrame(update);
    });

    // –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    leftBtn.addEventListener('touchstart', e => {
      e.preventDefault();
      playerX -= 8;
      setPlayerPos();
    });
    rightBtn.addEventListener('touchstart', e => {
      e.preventDefault();
      playerX += 8;
      setPlayerPos();
    });
    leftBtn.addEventListener('click', () => { playerX -= 8; setPlayerPos(); });
    rightBtn.addEventListener('click', () => { playerX += 8; setPlayerPos(); });

    // —Å–≤–∞–π–ø—ã
    let touchStartX = null;
    game.addEventListener('touchstart', e => {
      if (e.touches.length === 1) {
        touchStartX = e.touches[0].clientX;
      }
    });
    game.addEventListener('touchmove', e => {
      if (touchStartX === null) return;
      const dx = e.touches[0].clientX - touchStartX;
      if (Math.abs(dx) > 25) {
        playerX += dx > 0 ? 4 : -4;
        setPlayerPos();
        touchStartX = e.touches[0].clientX;
      }
    });
    game.addEventListener('touchend', () => {
      touchStartX = null;
    });

    // —Å—Ç—Ä–µ–ª–∫–∏ –Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ (–¥–ª—è —Ç–µ—Å—Ç–æ–≤ –Ω–∞ –ü–ö)
    window.addEventListener('keydown', e => {
      if (e.key === 'ArrowLeft') { playerX -= 6; setPlayerPos(); }
      if (e.key === 'ArrowRight') { playerX += 6; setPlayerPos(); }
    });

    setPlayerPos();
  </script>
</body>
</html>
